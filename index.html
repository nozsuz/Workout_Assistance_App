<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="icon.png">
    <title>AIç­‹ãƒˆãƒ¬å› ver.1.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
            min-width: 120px;
        }

        .tab.active {
            color: #ff6b6b;
            border-bottom: 3px solid #ff6b6b;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .workout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .workout-category {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #ff6b6b;
        }

        .workout-category h3 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .exercise-list {
            list-style: none;
        }

        .exercise-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .exercise-list li:hover {
            background: #e9ecef;
            padding-left: 10px;
        }

        .exercise-list li:last-child {
            border-bottom: none;
        }

        .beginner-program {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .beginner-program h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .week-schedule {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .day-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .day-card h4 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .day-card ul {
            padding-left: 20px;
        }

        .workout-log {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }

        .log-form {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .set-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .set-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .set-input label {
            font-size: 0.9em;
            margin-bottom: 0;
            text-align: center;
        }

        .set-input input {
            width: 100%;
            padding: 8px;
            text-align: center;
        }

        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255,107,107,0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(116,185,255,0.3);
        }

        .log-entries {
            margin-top: 20px;
        }

        .log-entry {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .log-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .log-entry-date {
            font-weight: 600;
            color: #ff6b6b;
        }

        .log-entry-exercise {
            font-weight: 600;
            color: #333;
        }

        .log-entry-sets {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .set-badge {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .tips {
            background: linear-gradient(135deg, #55a3ff, #003d82);
            color: white;
            padding: 25px;
            border-radius: 15px;
        }
        
        .tips h3 {
            margin-bottom: 15px;
        }

        .tips ul {
            list-style-position: inside;
        }

        .tips li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .ai-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
        }

        .ai-header h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .api-key-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .api-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .api-warning h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .api-warning ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .api-warning li {
            margin-bottom: 5px;
        }

        .alternative-section {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 8px;
            border: 1px solid #bee5eb;
        }

        .alternative-section h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .chat-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .ai-message, .user-message {
            display: flex;
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-in;
        }

        .user-message {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            margin: 0 10px;
            flex-shrink: 0;
        }

        .ai-message .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .user-message .message-avatar {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .user-message .message-avatar::after {
            content: 'ğŸ‘¤';
        }

        .message-content {
            max-width: 100%;
            word-wrap: break-word;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            line-height: 1.5;
        }
        
        .user-message .message-content {
            background: #e3f2fd;
        }

        .message-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .message-content li {
            margin-bottom: 5px;
        }

        .chat-input-container {
            border-top: 1px solid #e9ecef;
            padding-top: 15px;
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input-wrapper textarea {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            resize: vertical;
            min-height: 50px;
            font-family: inherit;
            font-size: 14px;
        }

        .chat-input-wrapper textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-send {
            min-width: 80px;
            height: 50px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .program-export {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
        }
        
        #ai-program-loader {
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        #ai-program-loader h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        #program-details {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .program-day-card {
            background-color: #fff;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .program-day-card h4 {
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }

        .program-day-card ul {
            list-style: none;
            padding: 0;
        }

        .program-exercise-item {
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.95em;
        }

        .program-exercise-item:hover {
            background-color: #e3f2fd;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            .workout-grid, .week-schedule, #program-details {
                grid-template-columns: 1fr;
            }
            .set-inputs {
                 grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’ª ç­‹ãƒˆãƒ¬åˆå¿ƒè€…ã‚¬ã‚¤ãƒ‰</h1>
            <p>åŠ¹æœçš„ãªãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã§ç†æƒ³ã®ä½“ã‚’æ‰‹ã«å…¥ã‚Œã‚ˆã†</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('menu')">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§</button>
                <button class="tab" onclick="showTab('program')">åˆå¿ƒè€…ãƒ—ãƒ­ã‚°ãƒ©ãƒ </button>
                <button class="tab" onclick="showTab('ai-program')">AI ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆ</button>
                <button class="tab" onclick="showTab('log')">è¨˜éŒ²ãƒ»è¿½è·¡</button>
                <button class="tab" onclick="showTab('tips')">ã‚³ãƒ„ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹</button>
            </div>

            <div id="menu" class="tab-content active">
                <div class="workout-grid">
                    <div class="workout-category">
                        <h3>ä¸ŠåŠèº«ï¼ˆèƒ¸ãƒ»è‚©ãƒ»è…•ï¼‰</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹')">ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹</li>
                            <li onclick="selectExercise('ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹')">ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹</li>
                            <li onclick="selectExercise('ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—')">ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—</li>
                            <li onclick="selectExercise('ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹')">ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹</li>
                            <li onclick="selectExercise('ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º')">ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º</li>
                            <li onclick="selectExercise('ãƒã‚¤ã‚»ãƒƒãƒ—ã‚«ãƒ¼ãƒ«')">ãƒã‚¤ã‚»ãƒƒãƒ—ã‚«ãƒ¼ãƒ«</li>
                            <li onclick="selectExercise('ãƒˆãƒ©ã‚¤ã‚»ãƒƒãƒ—ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³')">ãƒˆãƒ©ã‚¤ã‚»ãƒƒãƒ—ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³</li>
                        </ul>
                    </div>
                    <div class="workout-category">
                        <h3>èƒŒä¸­</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ')">ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ</li>
                            <li onclick="selectExercise('ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³')">ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³</li>
                            <li onclick="selectExercise('ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°')">ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°</li>
                            <li onclick="selectExercise('ãƒ—ãƒ«ã‚¢ãƒƒãƒ—')">ãƒ—ãƒ«ã‚¢ãƒƒãƒ—</li>
                            <li onclick="selectExercise('ãƒ¯ãƒ³ãƒãƒ³ãƒ‰ãƒ­ãƒ¼')">ãƒ¯ãƒ³ãƒãƒ³ãƒ‰ãƒ­ãƒ¼</li>
                            <li onclick="selectExercise('ã‚·ãƒ¥ãƒ©ãƒƒã‚°')">ã‚·ãƒ¥ãƒ©ãƒƒã‚°</li>
                        </ul>
                    </div>
                    <div class="workout-category">
                        <h3>ä¸‹åŠèº«</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ')">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</li>
                            <li onclick="selectExercise('ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹')">ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹</li>
                            <li onclick="selectExercise('ãƒ©ãƒ³ã‚¸')">ãƒ©ãƒ³ã‚¸</li>
                            <li onclick="selectExercise('ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«')">ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«</li>
                            <li onclick="selectExercise('ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º')">ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º</li>
                            <li onclick="selectExercise('ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ')">ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ</li>
                        </ul>
                    </div>
                    <div class="workout-category">
                        <h3>ä½“å¹¹ãƒ»è…¹ç­‹</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('ãƒ—ãƒ©ãƒ³ã‚¯')">ãƒ—ãƒ©ãƒ³ã‚¯</li>
                            <li onclick="selectExercise('ã‚¯ãƒ©ãƒ³ãƒ')">ã‚¯ãƒ©ãƒ³ãƒ</li>
                            <li onclick="selectExercise('ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º')">ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º</li>
                            <li onclick="selectExercise('ãƒ­ã‚·ã‚¢ãƒ³ãƒ„ã‚¤ã‚¹ãƒˆ')">ãƒ­ã‚·ã‚¢ãƒ³ãƒ„ã‚¤ã‚¹ãƒˆ</li>
                            <li onclick="selectExercise('ãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚¯ãƒ©ã‚¤ãƒãƒ¼')">ãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚¯ãƒ©ã‚¤ãƒãƒ¼</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="program" class="tab-content">
                <div class="beginner-program">
                    <h3>ğŸ”¥ åˆå¿ƒè€…å‘ã‘é€±3å›ãƒ—ãƒ­ã‚°ãƒ©ãƒ </h3>
                    <p>é€±3å›ã€1æ—¥ãŠãã«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚æœ€åˆã¯è»½ã„é‡é‡ã‹ã‚‰å§‹ã‚ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’é‡è¦–ã—ã¾ã—ã‚‡ã†ã€‚</p>
                    <div class="week-schedule">
                        <div class="day-card">
                            <h4>æœˆæ›œæ—¥ - ä¸ŠåŠèº«A</h4>
                            <ul>
                                <li>ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹ 3ã‚»ãƒƒãƒˆ Ã— 8-10å›</li>
                                <li>ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ 3ã‚»ãƒƒãƒˆ Ã— 8-10å›</li>
                                <li>ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ 3ã‚»ãƒƒãƒˆ Ã— 10-12å›</li>
                                <li>ãƒã‚¤ã‚»ãƒƒãƒ—ã‚«ãƒ¼ãƒ« 2ã‚»ãƒƒãƒˆ Ã— 12-15å›</li>
                                <li>ãƒˆãƒ©ã‚¤ã‚»ãƒƒãƒ—ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ 2ã‚»ãƒƒãƒˆ Ã— 12-15å›</li>
                            </ul>
                        </div>
                        <div class="day-card">
                            <h4>æ°´æ›œæ—¥ - ä¸‹åŠèº«</h4>
                            <ul>
                                <li>ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ 3ã‚»ãƒƒãƒˆ Ã— 10-12å›</li>
                                <li>ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹ 3ã‚»ãƒƒãƒˆ Ã— 12-15å›</li>
                                <li>ãƒ©ãƒ³ã‚¸ 2ã‚»ãƒƒãƒˆ Ã— 10å›ï¼ˆå„è„šï¼‰</li>
                                <li>ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ« 3ã‚»ãƒƒãƒˆ Ã— 12-15å›</li>
                                <li>ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º 3ã‚»ãƒƒãƒˆ Ã— 15-20å›</li>
                                <li>ãƒ—ãƒ©ãƒ³ã‚¯ 3ã‚»ãƒƒãƒˆ Ã— 30-60ç§’</li>
                            </ul>
                        </div>
                        <div class="day-card">
                            <h4>é‡‘æ›œæ—¥ - ä¸ŠåŠèº«B</h4>
                            <ul>
                                <li>ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ 3ã‚»ãƒƒãƒˆ Ã— 6-8å›</li>
                                <li>ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹ 3ã‚»ãƒƒãƒˆ Ã— 8-10å›</li>
                                <li>ãƒ­ãƒ¼ã‚¤ãƒ³ã‚° 3ã‚»ãƒƒãƒˆ Ã— 8-10å›</li>
                                <li>ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º 3ã‚»ãƒƒãƒˆ Ã— 12-15å›</li>
                                <li>ã‚¯ãƒ©ãƒ³ãƒ 3ã‚»ãƒƒãƒˆ Ã— 15-20å›</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="ai-program" class="tab-content">
                <div class="ai-program-container">
                    <div class="ai-header">
                        <h3>ğŸ¤– AI ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆ</h3>
                        <p>ã‚ãªãŸã®ç›®æ¨™ã¨ä½“åŠ›ãƒ¬ãƒ™ãƒ«ã«åˆã‚ã›ãŸæœ€é©ãª1é€±é–“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¾ã™</p>
                    </div>
                    <div class="chat-container" id="chat-container">
                        <div class="chat-messages" id="chat-messages">
                            <div class="ai-message">
                                <div class="message-avatar">ğŸ¤–</div>
                                <div class="message-content">
                                    <p>ã“ã‚“ã«ã¡ã¯ï¼AI ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã§ã™ã€‚ã‚ãªãŸã«æœ€é©ãª1é€±é–“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚</p>
                                    <p>ã¾ãšã€ä»¥ä¸‹ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ï¼š</p>
                                    <ul>
                                        <li>ç¾åœ¨ã®é‹å‹•çµŒé¨“ãƒ»ä½“åŠ›ãƒ¬ãƒ™ãƒ«</li>
                                        <li>ä¸»ãªç›®æ¨™ï¼ˆç­‹åŠ›å‘ä¸Šã€æ¸›é‡ã€ä½“å‹æ”¹å–„ãªã©ï¼‰</li>
                                        <li>é€±ã«ä½•å›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ãã‚‹ã‹</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <div class="chat-input-wrapper">
                                <textarea id="user-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." rows="2"></textarea>
                                <button class="btn btn-send" onclick="sendMessage()" id="send-btn">
                                    <span id="send-text">é€ä¿¡</span>
                                    <span id="loading-text" style="display: none;">ğŸ¤”...</span>
                                </button>
                            </div>
                        </div>
                        <div class="quick-actions">
                            <button class="btn btn-secondary btn-small" onclick="sendQuickMessage('åˆå¿ƒè€…ã€é€±3å›ã€ç­‹åŠ›å‘ä¸Š')">
                                åˆå¿ƒè€…ãƒ»é€±3ãƒ»ç­‹åŠ›å‘ä¸Š
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="sendQuickMessage('ä¸­ç´šè€…ã€é€±4å›ã€æ¸›é‡')">
                                ä¸­ç´šè€…ãƒ»é€±4ãƒ»æ¸›é‡
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="sendQuickMessage('ä¸Šç´šè€…ã€é€±5å›ã€ç­‹è‚¥å¤§')">
                                ä¸Šç´šè€…ãƒ»é€±5ãƒ»ç­‹è‚¥å¤§
                            </button>
                        </div>
                        <div class="program-export" id="program-export" style="display: none;">
                            <button class="btn" onclick="parseAndSaveProgram()">ğŸ“… ä½œæˆã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¨˜éŒ²ãƒšãƒ¼ã‚¸ã«ä¿å­˜</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="log" class="tab-content">
                <div id="ai-program-loader" class="workout-log">
                    <h3>ğŸ¤– AIä½œæˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰è¨˜éŒ²</h3>
                    <div class="form-group">
                        <label for="program-select">ä¿å­˜ã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠ</label>
                        <select id="program-select" onchange="displayProgramDetails(this.value)">
                            <option value="">ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <div id="program-details">
                    </div>
                    <div id="program-actions" style="margin-top: 15px; text-align: right; display: none;">
                        <button class="btn" onclick="deleteSelectedProgram()" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">é¸æŠä¸­ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å‰Šé™¤</button>
                    </div>
                </div>
                <div class="workout-log" id="manual-log-section" style="margin-top: 30px;">
                    <h3>ğŸ“Š æ‰‹å‹•ã§ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆè¨˜éŒ²</h3>
                    <div class="log-form">
                        <div class="form-group">
                            <label for="exercise-select">ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºé¸æŠ</label>
                            <select id="exercise-select">
                                <option value="">ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã‚’é¸æŠ...</option>
                                <option value="ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹">ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹">ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—">ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—</option>
                                <option value="ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹">ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹</option>
                                <option value="ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º">ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º</option>
                                <option value="ãƒã‚¤ã‚»ãƒƒãƒ—ã‚«ãƒ¼ãƒ«">ãƒã‚¤ã‚»ãƒƒãƒ—ã‚«ãƒ¼ãƒ«</option>
                                <option value="ãƒˆãƒ©ã‚¤ã‚»ãƒƒãƒ—ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³">ãƒˆãƒ©ã‚¤ã‚»ãƒƒãƒ—ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³</option>
                                <option value="ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ">ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ</option>
                                <option value="ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³">ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³</option>
                                <option value="ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°">ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°</option>
                                <option value="ãƒ—ãƒ«ã‚¢ãƒƒãƒ—">ãƒ—ãƒ«ã‚¢ãƒƒãƒ—</option>
                                <option value="ãƒ¯ãƒ³ãƒãƒ³ãƒ‰ãƒ­ãƒ¼">ãƒ¯ãƒ³ãƒãƒ³ãƒ‰ãƒ­ãƒ¼</option>
                                <option value="ã‚·ãƒ¥ãƒ©ãƒƒã‚°">ã‚·ãƒ¥ãƒ©ãƒƒã‚°</option>
                                <option value="ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</option>
                                <option value="ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹">ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒ©ãƒ³ã‚¸">ãƒ©ãƒ³ã‚¸</option>
                                <option value="ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«">ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«</option>
                                <option value="ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º">ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º</option>
                                <option value="ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ">ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ</option>
                                <option value="ãƒ—ãƒ©ãƒ³ã‚¯">ãƒ—ãƒ©ãƒ³ã‚¯</option>
                                <option value="ã‚¯ãƒ©ãƒ³ãƒ">ã‚¯ãƒ©ãƒ³ãƒ</option>
                                <option value="ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º">ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º</option>
                                <option value="ãƒ­ã‚·ã‚¢ãƒ³ãƒ„ã‚¤ã‚¹ãƒˆ">ãƒ­ã‚·ã‚¢ãƒ³ãƒ„ã‚¤ã‚¹ãƒˆ</option>
                                <option value="ãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚¯ãƒ©ã‚¤ãƒãƒ¼">ãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚¯ãƒ©ã‚¤ãƒãƒ¼</option>
                            </select>
                        </div>
                        <div class="set-inputs">
                            <div class="set-input"><label>1ã‚»ãƒƒãƒˆç›®</label><input type="number" id="set1-weight" placeholder="é‡é‡(kg)" step="0.5"><input type="number" id="set1-reps" placeholder="å›æ•°" min="1"></div>
                            <div class="set-input"><label>2ã‚»ãƒƒãƒˆç›®</label><input type="number" id="set2-weight" placeholder="é‡é‡(kg)" step="0.5"><input type="number" id="set2-reps" placeholder="å›æ•°" min="1"></div>
                            <div class="set-input"><label>3ã‚»ãƒƒãƒˆç›®</label><input type="number" id="set3-weight" placeholder="é‡é‡(kg)" step="0.5"><input type="number" id="set3-reps" placeholder="å›æ•°" min="1"></div>
                            <div class="set-input"><label>4ã‚»ãƒƒãƒˆç›®</label><input type="number" id="set4-weight" placeholder="é‡é‡(kg)" step="0.5"><input type="number" id="set4-reps" placeholder="å›æ•°" min="1"></div>
                        </div>
                        <button class="btn" onclick="saveWorkout()">è¨˜éŒ²ã‚’ä¿å­˜</button>
                    </div>
                    <div class="log-entries" id="log-entries">
                        <h4>ğŸ“ éå»ã®è¨˜éŒ²</h4>
                        <div id="workout-history"></div>
                    </div>
                </div>
            </div>

            <div id="tips" class="tab-content">
                <div class="tips">
                    <h3>ğŸ’¡ ç­‹ãƒˆãƒ¬æˆåŠŸã®ã‚³ãƒ„</h3>
                    <ul>
                        <li><strong>ãƒ•ã‚©ãƒ¼ãƒ é‡è¦–ï¼š</strong>é‡é‡ã‚ˆã‚Šã‚‚æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã‚’å„ªå…ˆã—ã¾ã—ã‚‡ã†</li>
                        <li><strong>æ¼¸é€²æ€§éè² è·ï¼š</strong>å¾ã€…ã«é‡é‡ã‚„å›æ•°ã‚’å¢—ã‚„ã—ã¦ã„ãã¾ã™</li>
                        <li><strong>ååˆ†ãªä¼‘æ¯ï¼š</strong>ç­‹è‚‰ã¯ä¼‘æ¯ä¸­ã«æˆé•·ã—ã¾ã™ï¼ˆ48-72æ™‚é–“ï¼‰</li>
                        <li><strong>æ „é¤Šè£œçµ¦ï¼š</strong>ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’ä½“é‡Ã—1.5-2gæ‘‚å–ã—ã¾ã—ã‚‡ã†</li>
                        <li><strong>æ°´åˆ†è£œçµ¦ï¼š</strong>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­ã¯å°ã¾ã‚ã«æ°´åˆ†ã‚’å–ã‚Šã¾ã—ã‚‡ã†</li>
                        <li><strong>ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ï¼š</strong>è»½ã„æœ‰é…¸ç´ é‹å‹•ã¨å‹•çš„ã‚¹ãƒˆãƒ¬ãƒƒãƒã‹ã‚‰å§‹ã‚ã¾ã™</li>
                        <li><strong>ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼š</strong>é™çš„ã‚¹ãƒˆãƒ¬ãƒƒãƒã§ç­‹è‚‰ã‚’ã»ãã—ã¾ã—ã‚‡ã†</li>
                        <li><strong>ç¶™ç¶šæ€§ï¼š</strong>é€±2-3å›ã€3ãƒ¶æœˆç¶šã‘ã‚‹ã“ã¨ã§åŠ¹æœã‚’å®Ÿæ„Ÿã§ãã¾ã™</li>
                    </ul>
                </div>
                <div class="tips" style="background: linear-gradient(135deg, #26d0ce, #1a2a6c); margin-top: 20px;">
                    <h3>âš ï¸ å®‰å…¨ã«é–¢ã™ã‚‹æ³¨æ„ç‚¹</h3>
                    <ul>
                        <li><strong>ä½“èª¿ç®¡ç†ï¼š</strong>ä½“èª¿ãŒæ‚ªã„æ™‚ã¯ç„¡ç†ã‚’ã—ãªã„ã§ãã ã•ã„</li>
                        <li><strong>ã‚¹ãƒãƒƒã‚¿ãƒ¼ï¼š</strong>é«˜é‡é‡ã‚’æ‰±ã†æ™‚ã¯ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã«è£œåŠ©ã‚’ä¾é ¼</li>
                        <li><strong>é™ç•Œã‚’çŸ¥ã‚‹ï¼š</strong>è‡ªåˆ†ã®é™ç•Œã‚’ç†è§£ã—ã€ç„¡èŒ¶ã‚’ã—ãªã„</li>
                        <li><strong>å™¨å…·ã®ç‚¹æ¤œï¼š</strong>ä½¿ç”¨å‰ã«å™¨å…·ã®å®‰å…¨æ€§ã‚’ç¢ºèª</li>
                        <li><strong>é©åˆ‡ãªæœè£…ï¼š</strong>å‹•ãã‚„ã™ãã€å®‰å…¨ãªæœè£…ã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</li>
                        <li><strong>åŒ»å¸«ã®ç›¸è«‡ï¼š</strong>æŒç—…ãŒã‚ã‚‹å ´åˆã¯åŒ»å¸«ã«ç›¸è«‡ã—ã¦ã‹ã‚‰é–‹å§‹</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let workoutHistory = JSON.parse(localStorage.getItem('workoutHistory')) || [];
        let conversationHistory = [];

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            const targetTab = document.querySelector(`.tab[onclick="showTab('${tabName}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            document.getElementById(tabName).classList.add('active');
            if (tabName === 'log') {
                displayWorkoutHistory();
                loadSavedPrograms();
            }
        }

        async function callApi(message) {
            const historyForApi = conversationHistory.map(item => ({
                role: item.isUser ? "user" : "model",
                parts: [{ text: item.content.split(/```json/)[0].trim() }] // JSONã‚’é™¤ã„ãŸãƒ†ã‚­ã‚¹ãƒˆéƒ¨åˆ†ã®ã¿ã‚’å±¥æ­´ã¨ã™ã‚‹
            }));

            try {
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        history: historyForApi,
                        message: message 
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error ${response.status}: ${errorData.error}`);
                }
                const data = await response.json();
                return data.text;
            } catch (error) {
                console.error("API call failed:", error);
                throw error;
            }
        }

        function addMessage(content, isUser = false) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'user-message' : 'ai-message';
            const messageContentDiv = document.createElement('div');
            messageContentDiv.className = 'message-content';

            conversationHistory.push({ content: content, isUser: isUser });

            let displayHTML = formatMessage(content);
            const jsonMatch = content.match(/```json\s*([\s\S]*?)\s*```/);

            if (!isUser && jsonMatch) {
                try {
                    const program = JSON.parse(jsonMatch[1]);
                    const introText = content.split('```json')[0].trim();
                    displayHTML = formatMessage(introText) + '<p style="margin-top:10px; padding:10px; background-color:#eef; border-radius:5px;"><em>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ä¸‹éƒ¨ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ä¿å­˜ã§ãã¾ã™ã€‚</em></p>';
                } catch (e) { /* ãƒ‘ãƒ¼ã‚¹å¤±æ•—æ™‚ã¯ãã®ã¾ã¾è¡¨ç¤º */ }
                
                document.getElementById('program-export').style.display = 'block';
            } else if (!isUser) {
                document.getElementById('program-export').style.display = 'none';
            }
            
            messageContentDiv.innerHTML = displayHTML;

            messageDiv.innerHTML = `<div class="message-avatar">${isUser ? '' : 'ğŸ‘¤'}</div>`;
            messageDiv.appendChild(messageContentDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function formatMessage(text) {
            // JSONãƒ–ãƒ­ãƒƒã‚¯ã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãªã„ã‚ˆã†ã«ä¿è­·
            const jsonBlocks = [];
            let tempText = text.replace(/```json\s*([\s\S]*?)\s*```/g, (match, p1) => {
                jsonBlocks.push(match);
                return `__JSON_BLOCK_${jsonBlocks.length - 1}__`;
            });

            // åŸºæœ¬çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            tempText = tempText
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');

            // JSONãƒ–ãƒ­ãƒƒã‚¯ã‚’å…ƒã«æˆ»ã™
            tempText = tempText.replace(/__JSON_BLOCK_(\d+)__/g, (match, p1) => {
                return jsonBlocks[p1];
            });
            
            return tempText;
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;
            addMessage(message, true);
            input.value = '';
            const sendBtn = document.getElementById('send-btn');
            const sendText = document.getElementById('send-text');
            const loadingText = document.getElementById('loading-text');
            sendBtn.disabled = true;
            sendText.style.display = 'none';
            loadingText.style.display = 'inline';
            try {
                let response = await callApi(message);
                addMessage(response, false);
            } catch (error) {
                addMessage(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}<br>ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€.envãƒ•ã‚¡ã‚¤ãƒ«ã«APIã‚­ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚`, false);
            } finally {
                sendBtn.disabled = false;
                sendText.style.display = 'inline';
                loadingText.style.display = 'none';
            }
        }
        
        function sendQuickMessage(message) {
            document.getElementById('user-input').value = message;
            sendMessage();
        }
        
        function parseAndSaveProgram() {
            const latestAiMessage = conversationHistory.filter(m => !m.isUser).pop();
            if (!latestAiMessage) {
                alert('ä¿å­˜å¯¾è±¡ã®AIå¿œç­”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }

            const jsonMatch = latestAiMessage.content.match(/```json\s*([\s\S]*?)\s*```/);
            if (!jsonMatch || !jsonMatch[1]) {
                alert('AIã®å¿œç­”ã‹ã‚‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆJSONå½¢å¼ï¼‰ã‚’æŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
                return;
            }

            try {
                const programData = JSON.parse(jsonMatch[1]);
                const program = {
                    id: new Date().getTime(),
                    name: programData.programName || `AIç”Ÿæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ  (${new Date().toLocaleDateString()})`,
                    days: programData.days.map(day => ({
                        dayName: day.dayName,
                        exercises: day.isRestDay ? [] : day.exercises.map(ex => ({
                            name: ex.name,
                            sets: ex.sets,
                            reps: ex.reps.toString(),
                            weight: ''
                        }))
                    }))
                };

                if (program.days.length > 0) {
                    let savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
                    savedPrograms.unshift(program);
                    localStorage.setItem('aiPrograms', JSON.stringify(savedPrograms));
                    alert('AIãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ã€Œè¨˜éŒ²ãƒ»è¿½è·¡ã€ãƒšãƒ¼ã‚¸ã‹ã‚‰å‘¼ã³å‡ºã›ã¾ã™ã€‚');
                    document.getElementById('program-export').style.display = 'none';
                } else {
                    alert('ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æœ‰åŠ¹ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                }
            } catch (error) {
                console.error("JSONã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                alert(`ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚AIã®å¿œç­”ãŒæ­£ã—ã„JSONå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\nã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function loadSavedPrograms() {
            const savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
            const selectEl = document.getElementById('program-select');
            const loaderContainer = document.getElementById('ai-program-loader');
            
            selectEl.innerHTML = '<option value="">ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            savedPrograms.forEach(program => {
                const option = document.createElement('option');
                option.value = program.id;
                option.textContent = program.name;
                selectEl.appendChild(option);
            });
            
            loaderContainer.style.display = savedPrograms.length > 0 ? 'block' : 'none';
            displayProgramDetails('');
        }

        function displayProgramDetails(programId) {
            const detailsContainer = document.getElementById('program-details');
            const actionsContainer = document.getElementById('program-actions');

            if (!programId) {
                detailsContainer.innerHTML = '';
                if(actionsContainer) actionsContainer.style.display = 'none';
                return;
            }
            const savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
            const program = savedPrograms.find(p => p.id == programId);
            if (!program) {
                detailsContainer.innerHTML = '';
                if(actionsContainer) actionsContainer.style.display = 'none';
                return;
            }
            detailsContainer.innerHTML = program.days.map(day => `
                <div class="program-day-card">
                    <h4>${day.dayName}</h4>
                    <ul>
                        ${day.exercises.length > 0 ? day.exercises.map(ex => `
                            <li class="program-exercise-item" onclick='setExerciseFromProgram(${JSON.stringify(ex)})'>
                                ${ex.name}: ${ex.sets}ã‚»ãƒƒãƒˆ Ã— ${ex.reps}å›
                            </li>
                        `).join('') : '<li>ä¼‘æ¯æ—¥</li>'}
                    </ul>
                </div>
            `).join('');
            if(actionsContainer) actionsContainer.style.display = 'block';
        }
        
        function deleteSelectedProgram() {
            const selectEl = document.getElementById('program-select');
            const programId = selectEl.value;

            if (!programId) {
                alert('å‰Šé™¤ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (confirm('æœ¬å½“ã«ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
                let savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
                savedPrograms = savedPrograms.filter(p => p.id != programId);
                localStorage.setItem('aiPrograms', JSON.stringify(savedPrograms));
                
                alert('ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
                loadSavedPrograms();
            }
        }

        function setExerciseFromProgram(exerciseData) {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`set${i}-weight`).value = '';
                document.getElementById(`set${i}-reps`).value = '';
            }
            const exerciseSelect = document.getElementById('exercise-select');
            let optionExists = Array.from(exerciseSelect.options).some(opt => opt.value === exerciseData.name);
            if (!optionExists) {
                exerciseSelect.add(new Option(exerciseData.name, exerciseData.name, true, true));
            }
            exerciseSelect.value = exerciseData.name;
            for (let i = 1; i <= exerciseData.sets; i++) {
                if (i > 4) break;
                const weightInput = document.getElementById(`set${i}-weight`);
                const repsInput = document.getElementById(`set${i}-reps`);
                if(exerciseData.weight) weightInput.value = exerciseData.weight;
                repsInput.value = exerciseData.reps.split(/[-~ï½]/)[0].trim();
            }
            document.getElementById('manual-log-section').scrollIntoView({ behavior: 'smooth' });
        }

        function selectExercise(exerciseName) {
            showTab('log');
            const selectEl = document.getElementById('exercise-select');
            selectEl.value = exerciseName;
            document.getElementById('manual-log-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function saveWorkout() {
            const exercise = document.getElementById('exercise-select').value;
            if (!exercise) {
                alert('ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            const sets = [];
            for (let i = 1; i <= 4; i++) {
                const weight = document.getElementById(`set${i}-weight`).value;
                const reps = document.getElementById(`set${i}-reps`).value;
                if (weight && reps) {
                    sets.push({ weight: parseFloat(weight), reps: parseInt(reps) });
                }
            }
            if (sets.length === 0) {
                alert('æœ€ä½1ã‚»ãƒƒãƒˆã®è¨˜éŒ²ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            workoutHistory.unshift({
                date: new Date().toLocaleDateString('ja-JP'),
                exercise: exercise,
                sets: sets,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));
            document.getElementById('exercise-select').value = '';
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`set${i}-weight`).value = '';
                document.getElementById(`set${i}-reps`).value = '';
            }
            displayWorkoutHistory();
            alert('è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        function displayWorkoutHistory() {
            const historyContainer = document.getElementById('workout-history');
            if (workoutHistory.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            historyContainer.innerHTML = workoutHistory.slice(0, 15).map(workout => `
                <div class="log-entry">
                    <div class="log-entry-header">
                        <span class="log-entry-date">${workout.date}</span>
                        <span class="log-entry-exercise">${workout.exercise}</span>
                    </div>
                    <div class="log-entry-sets">
                        ${workout.sets.map((set, index) => `
                            <span class="set-badge">${index + 1}ã‚»ãƒƒãƒˆ: ${set.weight}kg Ã— ${set.reps}å›</span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        document.addEventListener('DOMContentLoaded', function() {
            showTab('menu'); // åˆæœŸè¡¨ç¤ºã‚¿ãƒ–
            const userInput = document.getElementById('user-input');
            if (userInput) {
                userInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
        });
    </script>
    </body>
</html>