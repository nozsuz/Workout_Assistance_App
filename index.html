<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="icon.png">
    <title>AIÁ≠ã„Éà„É¨Âêõ ver.1.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
            min-width: 120px;
        }

        .tab.active {
            color: #ff6b6b;
            border-bottom: 3px solid #ff6b6b;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .workout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .workout-category {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #ff6b6b;
        }

        .workout-category h3 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .exercise-list {
            list-style: none;
        }

        .exercise-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .exercise-list li:hover {
            background: #e9ecef;
            padding-left: 10px;
        }

        .exercise-list li:last-child {
            border-bottom: none;
        }

        .beginner-program {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .beginner-program h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .week-schedule {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .day-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .day-card h4 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .day-card ul {
            padding-left: 20px;
        }

        .workout-log {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }

        .log-form {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .set-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .set-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .set-input label {
            font-size: 0.9em;
            margin-bottom: 0;
            text-align: center;
        }

        .set-input input {
            width: 100%;
            padding: 8px;
            text-align: center;
        }

        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255,107,107,0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(116,185,255,0.3);
        }

        .log-entries {
            margin-top: 20px;
        }

        .log-entry {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .log-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .log-entry-date {
            font-weight: 600;
            color: #ff6b6b;
        }

        .log-entry-exercise {
            font-weight: 600;
            color: #333;
        }

        .log-entry-sets {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .set-badge {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .tips {
            background: linear-gradient(135deg, #55a3ff, #003d82);
            color: white;
            padding: 25px;
            border-radius: 15px;
        }
        
        .tips h3 {
            margin-bottom: 15px;
        }

        .tips ul {
            list-style-position: inside;
        }

        .tips li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .ai-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
        }

        .ai-header h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .api-key-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .api-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .api-warning h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .api-warning ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .api-warning li {
            margin-bottom: 5px;
        }

        .alternative-section {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 8px;
            border: 1px solid #bee5eb;
        }

        .alternative-section h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .chat-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .ai-message, .user-message {
            display: flex;
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-in;
        }

        .user-message {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            margin: 0 10px;
            flex-shrink: 0;
        }

        .ai-message .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .user-message .message-avatar {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .user-message .message-avatar::after {
            content: 'üë§';
        }

        .message-content {
            max-width: 100%;
            word-wrap: break-word;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            line-height: 1.5;
        }
        
        .user-message .message-content {
            background: #e3f2fd;
        }

        .message-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .message-content li {
            margin-bottom: 5px;
        }

        .chat-input-container {
            border-top: 1px solid #e9ecef;
            padding-top: 15px;
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input-wrapper textarea {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            resize: vertical;
            min-height: 50px;
            font-family: inherit;
            font-size: 14px;
        }

        .chat-input-wrapper textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-send {
            min-width: 80px;
            height: 50px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .program-export {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
        }
        
        #ai-program-loader {
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        #ai-program-loader h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        #program-details {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .program-day-card {
            background-color: #fff;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .program-day-card h4 {
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }

        .program-day-card ul {
            list-style: none;
            padding: 0;
        }

        .program-exercise-item {
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.95em;
        }

        .program-exercise-item:hover {
            background-color: #e3f2fd;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            .workout-grid, .week-schedule, #program-details {
                grid-template-columns: 1fr;
            }
            .set-inputs {
                 grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí™ Á≠ã„Éà„É¨ÂàùÂøÉËÄÖ„Ç¨„Ç§„Éâ</h1>
            <p>ÂäπÊûúÁöÑ„Å™„ÉØ„Éº„ÇØ„Ç¢„Ç¶„Éà„ÅßÁêÜÊÉ≥„ÅÆ‰Ωì„ÇíÊâã„Å´ÂÖ•„Çå„Çà„ÅÜ</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('menu')">„É°„Éã„É•„Éº‰∏ÄË¶ß</button>
                <button class="tab" onclick="showTab('program')">ÂàùÂøÉËÄÖ„Éó„É≠„Ç∞„É©„É†</button>
                <button class="tab" onclick="showTab('ai-program')">AI „É°„Éã„É•„Éº‰ΩúÊàê</button>
                <button class="tab" onclick="showTab('log')">Ë®òÈå≤„ÉªËøΩË∑°</button>
                <button class="tab" onclick="showTab('tips')">„Ç≥„ÉÑ„Éª„Ç¢„Éâ„Éê„Ç§„Çπ</button>
            </div>

            <div id="menu" class="tab-content active">
                <div class="workout-grid">
                    <div class="workout-category">
                        <h3>‰∏äÂçäË∫´ÔºàËÉ∏„ÉªËÇ©„ÉªËÖïÔºâ</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('„Éô„É≥„ÉÅ„Éó„É¨„Çπ')">„Éô„É≥„ÉÅ„Éó„É¨„Çπ</li>
                            <li onclick="selectExercise('„ÉÄ„É≥„Éô„É´„Éó„É¨„Çπ')">„ÉÄ„É≥„Éô„É´„Éó„É¨„Çπ</li>
                            <li onclick="selectExercise('„Éó„ÉÉ„Ç∑„É•„Ç¢„ÉÉ„Éó')">„Éó„ÉÉ„Ç∑„É•„Ç¢„ÉÉ„Éó</li>
                            <li onclick="selectExercise('„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ')">„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ</li>
                            <li onclick="selectExercise('„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫')">„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫</li>
                            <li onclick="selectExercise('„Éê„Ç§„Çª„ÉÉ„Éó„Ç´„Éº„É´')">„Éê„Ç§„Çª„ÉÉ„Éó„Ç´„Éº„É´</li>
                            <li onclick="selectExercise('„Éà„É©„Ç§„Çª„ÉÉ„Éó„Ç®„ÇØ„Çπ„ÉÜ„É≥„Ç∑„Éß„É≥')">„Éà„É©„Ç§„Çª„ÉÉ„Éó„Ç®„ÇØ„Çπ„ÉÜ„É≥„Ç∑„Éß„É≥</li>
                        </ul>
                    </div>
                    <div class="workout-category">
                        <h3>ËÉå‰∏≠</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('„Éá„ÉÉ„Éâ„É™„Éï„Éà')">„Éá„ÉÉ„Éâ„É™„Éï„Éà</li>
                            <li onclick="selectExercise('„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥')">„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥</li>
                            <li onclick="selectExercise('„É≠„Éº„Ç§„É≥„Ç∞')">„É≠„Éº„Ç§„É≥„Ç∞</li>
                            <li onclick="selectExercise('„Éó„É´„Ç¢„ÉÉ„Éó')">„Éó„É´„Ç¢„ÉÉ„Éó</li>
                            <li onclick="selectExercise('„ÉØ„É≥„Éè„É≥„Éâ„É≠„Éº')">„ÉØ„É≥„Éè„É≥„Éâ„É≠„Éº</li>
                            <li onclick="selectExercise('„Ç∑„É•„É©„ÉÉ„Ç∞')">„Ç∑„É•„É©„ÉÉ„Ç∞</li>
                        </ul>
                    </div>
                    <div class="workout-category">
                        <h3>‰∏ãÂçäË∫´</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('„Çπ„ÇØ„ÉØ„ÉÉ„Éà')">„Çπ„ÇØ„ÉØ„ÉÉ„Éà</li>
                            <li onclick="selectExercise('„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ')">„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ</li>
                            <li onclick="selectExercise('„É©„É≥„Ç∏')">„É©„É≥„Ç∏</li>
                            <li onclick="selectExercise('„É¨„ÉÉ„Ç∞„Ç´„Éº„É´')">„É¨„ÉÉ„Ç∞„Ç´„Éº„É´</li>
                            <li onclick="selectExercise('„Ç´„Éº„Éï„É¨„Ç§„Ç∫')">„Ç´„Éº„Éï„É¨„Ç§„Ç∫</li>
                            <li onclick="selectExercise('„Éí„ÉÉ„Éó„Çπ„É©„Çπ„Éà')">„Éí„ÉÉ„Éó„Çπ„É©„Çπ„Éà</li>
                        </ul>
                    </div>
                    <div class="workout-category">
                        <h3>‰ΩìÂππ„ÉªËÖπÁ≠ã</h3>
                        <ul class="exercise-list">
                            <li onclick="selectExercise('„Éó„É©„É≥„ÇØ')">„Éó„É©„É≥„ÇØ</li>
                            <li onclick="selectExercise('„ÇØ„É©„É≥„ÉÅ')">„ÇØ„É©„É≥„ÉÅ</li>
                            <li onclick="selectExercise('„É¨„ÉÉ„Ç∞„É¨„Ç§„Ç∫')">„É¨„ÉÉ„Ç∞„É¨„Ç§„Ç∫</li>
                            <li onclick="selectExercise('„É≠„Ç∑„Ç¢„É≥„ÉÑ„Ç§„Çπ„Éà')">„É≠„Ç∑„Ç¢„É≥„ÉÑ„Ç§„Çπ„Éà</li>
                            <li onclick="selectExercise('„Éû„Ç¶„É≥„ÉÜ„É≥„ÇØ„É©„Ç§„Éû„Éº')">„Éû„Ç¶„É≥„ÉÜ„É≥„ÇØ„É©„Ç§„Éû„Éº</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="program" class="tab-content">
                <div class="beginner-program">
                    <h3>üî• ÂàùÂøÉËÄÖÂêë„ÅëÈÄ±3Âõû„Éó„É≠„Ç∞„É©„É†</h3>
                    <p>ÈÄ±3Âõû„ÄÅ1Êó•„Åä„Åç„Å´„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇÊúÄÂàù„ÅØËªΩ„ÅÑÈáçÈáè„Åã„ÇâÂßã„ÇÅ„Å¶„ÄÅ„Éï„Ç©„Éº„É†„ÇíÈáçË¶ñ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                    <div class="week-schedule">
                        <div class="day-card">
                            <h4>ÊúàÊõúÊó• - ‰∏äÂçäË∫´A</h4>
                            <ul>
                                <li>„Éô„É≥„ÉÅ„Éó„É¨„Çπ 3„Çª„ÉÉ„Éà √ó 8-10Âõû</li>
                                <li>„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥ 3„Çª„ÉÉ„Éà √ó 8-10Âõû</li>
                                <li>„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ 3„Çª„ÉÉ„Éà √ó 10-12Âõû</li>
                                <li>„Éê„Ç§„Çª„ÉÉ„Éó„Ç´„Éº„É´ 2„Çª„ÉÉ„Éà √ó 12-15Âõû</li>
                                <li>„Éà„É©„Ç§„Çª„ÉÉ„Éó„Ç®„ÇØ„Çπ„ÉÜ„É≥„Ç∑„Éß„É≥ 2„Çª„ÉÉ„Éà √ó 12-15Âõû</li>
                            </ul>
                        </div>
                        <div class="day-card">
                            <h4>Ê∞¥ÊõúÊó• - ‰∏ãÂçäË∫´</h4>
                            <ul>
                                <li>„Çπ„ÇØ„ÉØ„ÉÉ„Éà 3„Çª„ÉÉ„Éà √ó 10-12Âõû</li>
                                <li>„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ 3„Çª„ÉÉ„Éà √ó 12-15Âõû</li>
                                <li>„É©„É≥„Ç∏ 2„Çª„ÉÉ„Éà √ó 10ÂõûÔºàÂêÑËÑöÔºâ</li>
                                <li>„É¨„ÉÉ„Ç∞„Ç´„Éº„É´ 3„Çª„ÉÉ„Éà √ó 12-15Âõû</li>
                                <li>„Ç´„Éº„Éï„É¨„Ç§„Ç∫ 3„Çª„ÉÉ„Éà √ó 15-20Âõû</li>
                                <li>„Éó„É©„É≥„ÇØ 3„Çª„ÉÉ„Éà √ó 30-60Áßí</li>
                            </ul>
                        </div>
                        <div class="day-card">
                            <h4>ÈáëÊõúÊó• - ‰∏äÂçäË∫´B</h4>
                            <ul>
                                <li>„Éá„ÉÉ„Éâ„É™„Éï„Éà 3„Çª„ÉÉ„Éà √ó 6-8Âõû</li>
                                <li>„ÉÄ„É≥„Éô„É´„Éó„É¨„Çπ 3„Çª„ÉÉ„Éà √ó 8-10Âõû</li>
                                <li>„É≠„Éº„Ç§„É≥„Ç∞ 3„Çª„ÉÉ„Éà √ó 8-10Âõû</li>
                                <li>„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫ 3„Çª„ÉÉ„Éà √ó 12-15Âõû</li>
                                <li>„ÇØ„É©„É≥„ÉÅ 3„Çª„ÉÉ„Éà √ó 15-20Âõû</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="ai-program" class="tab-content">
                <div class="ai-program-container">
                    <div class="ai-header">
                        <h3>ü§ñ AI „Éà„É¨„Éº„Éä„Éº„Å®„É°„Éã„É•„Éº‰ΩúÊàê</h3>
                        <p>„ÅÇ„Å™„Åü„ÅÆÁõÆÊ®ô„Å®‰ΩìÂäõ„É¨„Éô„É´„Å´Âêà„Çè„Åõ„ÅüÊúÄÈÅ©„Å™1ÈÄ±Èñì„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„É°„Éã„É•„Éº„Çí‰ΩúÊàê„Åó„Åæ„Åô</p>
                    </div>
                    <div class="chat-container" id="chat-container">
                        <div class="chat-messages" id="chat-messages">
                            <div class="ai-message">
                                <div class="message-avatar">ü§ñ</div>
                                <div class="message-content">
                                    <p>„Åì„Çì„Å´„Å°„ÅØÔºÅAI „Éà„É¨„Éº„Éä„Éº„Åß„Åô„ÄÇ„ÅÇ„Å™„Åü„Å´ÊúÄÈÅ©„Å™1ÈÄ±Èñì„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„É°„Éã„É•„Éº„Çí‰ΩúÊàê„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                                    <p>„Åæ„Åö„ÄÅ‰ª•‰∏ã„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºö</p>
                                    <ul>
                                        <li>ÁèæÂú®„ÅÆÈÅãÂãïÁµåÈ®ì„Éª‰ΩìÂäõ„É¨„Éô„É´</li>
                                        <li>‰∏ª„Å™ÁõÆÊ®ôÔºàÁ≠ãÂäõÂêë‰∏ä„ÄÅÊ∏õÈáè„ÄÅ‰ΩìÂûãÊîπÂñÑ„Å™„Å©Ôºâ</li>
                                        <li>ÈÄ±„Å´‰ΩïÂõû„Éà„É¨„Éº„Éã„É≥„Ç∞„Åß„Åç„Çã„Åã</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <div class="chat-input-wrapper">
                                <textarea id="user-input" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ..." rows="2"></textarea>
                                <button class="btn btn-send" onclick="sendMessage()" id="send-btn">
                                    <span id="send-text">ÈÄÅ‰ø°</span>
                                    <span id="loading-text" style="display: none;">ü§î...</span>
                                </button>
                            </div>
                        </div>
                        <div class="quick-actions">
                            <button class="btn btn-secondary btn-small" onclick="sendQuickMessage('ÂàùÂøÉËÄÖ„ÄÅÈÄ±3Âõû„ÄÅÁ≠ãÂäõÂêë‰∏ä')">
                                ÂàùÂøÉËÄÖ„ÉªÈÄ±3„ÉªÁ≠ãÂäõÂêë‰∏ä
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="sendQuickMessage('‰∏≠Á¥öËÄÖ„ÄÅÈÄ±4Âõû„ÄÅÊ∏õÈáè')">
                                ‰∏≠Á¥öËÄÖ„ÉªÈÄ±4„ÉªÊ∏õÈáè
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="sendQuickMessage('‰∏äÁ¥öËÄÖ„ÄÅÈÄ±5Âõû„ÄÅÁ≠ãËÇ•Â§ß')">
                                ‰∏äÁ¥öËÄÖ„ÉªÈÄ±5„ÉªÁ≠ãËÇ•Â§ß
                            </button>
                        </div>
                        <div class="program-export" id="program-export" style="display: none;">
                            <button class="btn" onclick="parseAndSaveProgram()">üìÖ ‰ΩúÊàê„Åï„Çå„Åü„É°„Éã„É•„Éº„ÇíË®òÈå≤„Éö„Éº„Ç∏„Å´‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="log" class="tab-content">
                <div id="ai-program-loader" class="workout-log">
                    <h3>ü§ñ AI‰ΩúÊàê„É°„Éã„É•„Éº„Åã„ÇâË®òÈå≤</h3>
                    <div class="form-group">
                        <label for="program-select">‰øùÂ≠ò„Åó„Åü„Éó„É≠„Ç∞„É©„É†„ÇíÈÅ∏Êäû</label>
                        <select id="program-select" onchange="displayProgramDetails(this.value)">
                            <option value="">„Éó„É≠„Ç∞„É©„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                        </select>
                    </div>
                    <div id="program-details">
                    </div>
                    <div id="program-actions" style="margin-top: 15px; text-align: right; display: none;">
                        <button class="btn" onclick="deleteSelectedProgram()" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">ÈÅ∏Êäû‰∏≠„ÅÆ„Éó„É≠„Ç∞„É©„É†„ÇíÂâäÈô§</button>
                    </div>
                </div>
                <div class="workout-log" id="manual-log-section" style="margin-top: 30px;">
                    <h3>üìä ÊâãÂãï„Åß„ÉØ„Éº„ÇØ„Ç¢„Ç¶„ÉàË®òÈå≤</h3>
                    <div class="log-form">
                        <div class="form-group">
                            <label for="exercise-select">„Ç®„ÇØ„Çµ„Çµ„Ç§„Ç∫ÈÅ∏Êäû</label>
                            <select id="exercise-select">
                                <option value="">„Ç®„ÇØ„Çµ„Çµ„Ç§„Ç∫„ÇíÈÅ∏Êäû...</option>
                                <option value="„Éô„É≥„ÉÅ„Éó„É¨„Çπ">„Éô„É≥„ÉÅ„Éó„É¨„Çπ</option>
                                <option value="„ÉÄ„É≥„Éô„É´„Éó„É¨„Çπ">„ÉÄ„É≥„Éô„É´„Éó„É¨„Çπ</option>
                                <option value="„Éó„ÉÉ„Ç∑„É•„Ç¢„ÉÉ„Éó">„Éó„ÉÉ„Ç∑„É•„Ç¢„ÉÉ„Éó</option>
                                <option value="„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ">„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ</option>
                                <option value="„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫">„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫</option>
                                <option value="„Éê„Ç§„Çª„ÉÉ„Éó„Ç´„Éº„É´">„Éê„Ç§„Çª„ÉÉ„Éó„Ç´„Éº„É´</option>
                                <option value="„Éà„É©„Ç§„Çª„ÉÉ„Éó„Ç®„ÇØ„Çπ„ÉÜ„É≥„Ç∑„Éß„É≥">„Éà„É©„Ç§„Çª„ÉÉ„Éó„Ç®„ÇØ„Çπ„ÉÜ„É≥„Ç∑„Éß„É≥</option>
                                <option value="„Éá„ÉÉ„Éâ„É™„Éï„Éà">„Éá„ÉÉ„Éâ„É™„Éï„Éà</option>
                                <option value="„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥">„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥</option>
                                <option value="„É≠„Éº„Ç§„É≥„Ç∞">„É≠„Éº„Ç§„É≥„Ç∞</option>
                                <option value="„Éó„É´„Ç¢„ÉÉ„Éó">„Éó„É´„Ç¢„ÉÉ„Éó</option>
                                <option value="„ÉØ„É≥„Éè„É≥„Éâ„É≠„Éº">„ÉØ„É≥„Éè„É≥„Éâ„É≠„Éº</option>
                                <option value="„Ç∑„É•„É©„ÉÉ„Ç∞">„Ç∑„É•„É©„ÉÉ„Ç∞</option>
                                <option value="„Çπ„ÇØ„ÉØ„ÉÉ„Éà">„Çπ„ÇØ„ÉØ„ÉÉ„Éà</option>
                                <option value="„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ">„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ</option>
                                <option value="„É©„É≥„Ç∏">„É©„É≥„Ç∏</option>
                                <option value="„É¨„ÉÉ„Ç∞„Ç´„Éº„É´">„É¨„ÉÉ„Ç∞„Ç´„Éº„É´</option>
                                <option value="„Ç´„Éº„Éï„É¨„Ç§„Ç∫">„Ç´„Éº„Éï„É¨„Ç§„Ç∫</option>
                                <option value="„Éí„ÉÉ„Éó„Çπ„É©„Çπ„Éà">„Éí„ÉÉ„Éó„Çπ„É©„Çπ„Éà</option>
                                <option value="„Éó„É©„É≥„ÇØ">„Éó„É©„É≥„ÇØ</option>
                                <option value="„ÇØ„É©„É≥„ÉÅ">„ÇØ„É©„É≥„ÉÅ</option>
                                <option value="„É¨„ÉÉ„Ç∞„É¨„Ç§„Ç∫">„É¨„ÉÉ„Ç∞„É¨„Ç§„Ç∫</option>
                                <option value="„É≠„Ç∑„Ç¢„É≥„ÉÑ„Ç§„Çπ„Éà">„É≠„Ç∑„Ç¢„É≥„ÉÑ„Ç§„Çπ„Éà</option>
                                <option value="„Éû„Ç¶„É≥„ÉÜ„É≥„ÇØ„É©„Ç§„Éû„Éº">„Éû„Ç¶„É≥„ÉÜ„É≥„ÇØ„É©„Ç§„Éû„Éº</option>
                            </select>
                        </div>
                        <div class="set-inputs">
                            <div class="set-input"><label>1„Çª„ÉÉ„ÉàÁõÆ</label><input type="number" id="set1-weight" placeholder="ÈáçÈáè(kg)" step="0.5"><input type="number" id="set1-reps" placeholder="ÂõûÊï∞" min="1"></div>
                            <div class="set-input"><label>2„Çª„ÉÉ„ÉàÁõÆ</label><input type="number" id="set2-weight" placeholder="ÈáçÈáè(kg)" step="0.5"><input type="number" id="set2-reps" placeholder="ÂõûÊï∞" min="1"></div>
                            <div class="set-input"><label>3„Çª„ÉÉ„ÉàÁõÆ</label><input type="number" id="set3-weight" placeholder="ÈáçÈáè(kg)" step="0.5"><input type="number" id="set3-reps" placeholder="ÂõûÊï∞" min="1"></div>
                            <div class="set-input"><label>4„Çª„ÉÉ„ÉàÁõÆ</label><input type="number" id="set4-weight" placeholder="ÈáçÈáè(kg)" step="0.5"><input type="number" id="set4-reps" placeholder="ÂõûÊï∞" min="1"></div>
                        </div>
                        <button class="btn" onclick="saveWorkout()">Ë®òÈå≤„Çí‰øùÂ≠ò</button>
                    </div>
                    <div class="log-entries" id="log-entries">
                        <h4>üìù ÈÅéÂéª„ÅÆË®òÈå≤</h4>
                        <div id="workout-history"></div>
                    </div>
                </div>
            </div>

            <div id="tips" class="tab-content">
                <div class="tips">
                    <h3>üí° Á≠ã„Éà„É¨ÊàêÂäü„ÅÆ„Ç≥„ÉÑ</h3>
                    <ul>
                        <li><strong>„Éï„Ç©„Éº„É†ÈáçË¶ñÔºö</strong>ÈáçÈáè„Çà„Çä„ÇÇÊ≠£„Åó„ÅÑ„Éï„Ç©„Éº„É†„ÇíÂÑ™ÂÖà„Åó„Åæ„Åó„Çá„ÅÜ</li>
                        <li><strong>Êº∏ÈÄ≤ÊÄßÈÅéË≤†Ëç∑Ôºö</strong>Âæê„ÄÖ„Å´ÈáçÈáè„ÇÑÂõûÊï∞„ÇíÂ¢ó„ÇÑ„Åó„Å¶„ÅÑ„Åç„Åæ„Åô</li>
                        <li><strong>ÂçÅÂàÜ„Å™‰ºëÊÅØÔºö</strong>Á≠ãËÇâ„ÅØ‰ºëÊÅØ‰∏≠„Å´ÊàêÈï∑„Åó„Åæ„ÅôÔºà48-72ÊôÇÈñìÔºâ</li>
                        <li><strong>Ê†ÑÈ§äË£úÁµ¶Ôºö</strong>„Çø„É≥„Éë„ÇØË≥™„Çí‰ΩìÈáç√ó1.5-2gÊëÇÂèñ„Åó„Åæ„Åó„Çá„ÅÜ</li>
                        <li><strong>Ê∞¥ÂàÜË£úÁµ¶Ôºö</strong>„Éà„É¨„Éº„Éã„É≥„Ç∞‰∏≠„ÅØÂ∞è„Åæ„ÇÅ„Å´Ê∞¥ÂàÜ„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ</li>
                        <li><strong>„Ç¶„Ç©„Éº„É†„Ç¢„ÉÉ„ÉóÔºö</strong>ËªΩ„ÅÑÊúâÈÖ∏Á¥†ÈÅãÂãï„Å®ÂãïÁöÑ„Çπ„Éà„É¨„ÉÉ„ÉÅ„Åã„ÇâÂßã„ÇÅ„Åæ„Åô</li>
                        <li><strong>„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥Ôºö</strong>ÈùôÁöÑ„Çπ„Éà„É¨„ÉÉ„ÉÅ„ÅßÁ≠ãËÇâ„Çí„Åª„Åê„Åó„Åæ„Åó„Çá„ÅÜ</li>
                        <li><strong>Á∂ôÁ∂öÊÄßÔºö</strong>ÈÄ±2-3Âõû„ÄÅ3„É∂ÊúàÁ∂ö„Åë„Çã„Åì„Å®„ÅßÂäπÊûú„ÇíÂÆüÊÑü„Åß„Åç„Åæ„Åô</li>
                    </ul>
                </div>
                <div class="tips" style="background: linear-gradient(135deg, #26d0ce, #1a2a6c); margin-top: 20px;">
                    <h3>‚ö†Ô∏è ÂÆâÂÖ®„Å´Èñ¢„Åô„ÇãÊ≥®ÊÑèÁÇπ</h3>
                    <ul>
                        <li><strong>‰ΩìË™øÁÆ°ÁêÜÔºö</strong>‰ΩìË™ø„ÅåÊÇ™„ÅÑÊôÇ„ÅØÁÑ°ÁêÜ„Çí„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ</li>
                        <li><strong>„Çπ„Éù„ÉÉ„Çø„ÉºÔºö</strong>È´òÈáçÈáè„ÇíÊâ±„ÅÜÊôÇ„ÅØ„Éë„Éº„Éà„Éä„Éº„Å´Ë£úÂä©„Çí‰æùÈ†º</li>
                        <li><strong>ÈôêÁïå„ÇíÁü•„ÇãÔºö</strong>Ëá™ÂàÜ„ÅÆÈôêÁïå„ÇíÁêÜËß£„Åó„ÄÅÁÑ°Ëå∂„Çí„Åó„Å™„ÅÑ</li>
                        <li><strong>Âô®ÂÖ∑„ÅÆÁÇπÊ§úÔºö</strong>‰ΩøÁî®Ââç„Å´Âô®ÂÖ∑„ÅÆÂÆâÂÖ®ÊÄß„ÇíÁ¢∫Ë™ç</li>
                        <li><strong>ÈÅ©Âàá„Å™ÊúçË£ÖÔºö</strong>Âãï„Åç„ÇÑ„Åô„Åè„ÄÅÂÆâÂÖ®„Å™ÊúçË£Ö„Åß„Éà„É¨„Éº„Éã„É≥„Ç∞</li>
                        <li><strong>ÂåªÂ∏´„ÅÆÁõ∏Ë´áÔºö</strong>ÊåÅÁóÖ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÂåªÂ∏´„Å´Áõ∏Ë´á„Åó„Å¶„Åã„ÇâÈñãÂßã</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let workoutHistory = JSON.parse(localStorage.getItem('workoutHistory')) || [];
        let conversationHistory = [];

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            const targetTab = document.querySelector(`.tab[onclick="showTab('${tabName}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            document.getElementById(tabName).classList.add('active');
            if (tabName === 'log') {
                displayWorkoutHistory();
                loadSavedPrograms();
            }
        }

        async function callApi(message) {
            const historyForApi = conversationHistory.map(item => ({
                role: item.isUser ? "user" : "model",
                parts: [{ text: item.content.split(/```json/)[0].trim() }] // JSON„ÇíÈô§„ÅÑ„Åü„ÉÜ„Ç≠„Çπ„ÉàÈÉ®ÂàÜ„ÅÆ„Åø„ÇíÂ±•Ê≠¥„Å®„Åô„Çã
            }));

            try {
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        history: historyForApi,
                        message: message 
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error ${response.status}: ${errorData.error}`);
                }
                const data = await response.json();
                return data.text;
            } catch (error) {
                console.error("API call failed:", error);
                throw error;
            }
        }

        function addMessage(content, isUser = false) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'user-message' : 'ai-message';
            const messageContentDiv = document.createElement('div');
            messageContentDiv.className = 'message-content';

            conversationHistory.push({ content: content, isUser: isUser });

            let displayHTML = formatMessage(content);
            const jsonMatch = content.match(/```json\s*([\s\S]*?)\s*```/);

            if (!isUser && jsonMatch) {
                try {
                    const program = JSON.parse(jsonMatch[1]);
                    const introText = content.split('```json')[0].trim();
                    displayHTML = formatMessage(introText) + '<p style="margin-top:10px; padding:10px; background-color:#eef; border-radius:5px;"><em>„Éà„É¨„Éº„Éã„É≥„Ç∞„É°„Éã„É•„Éº„ÅåÁîüÊàê„Åï„Çå„Åæ„Åó„Åü„ÄÇ‰∏ãÈÉ®„ÅÆ„Éú„Çø„É≥„Åã„Çâ‰øùÂ≠ò„Åß„Åç„Åæ„Åô„ÄÇ</em></p>';
                } catch (e) { /* „Éë„Éº„ÇπÂ§±ÊïóÊôÇ„ÅØ„Åù„ÅÆ„Åæ„ÅæË°®Á§∫ */ }
                
                document.getElementById('program-export').style.display = 'block';
            } else if (!isUser) {
                document.getElementById('program-export').style.display = 'none';
            }
            
            messageContentDiv.innerHTML = displayHTML;

            messageDiv.innerHTML = `<div class="message-avatar">${isUser ? '' : 'üë§'}</div>`;
            messageDiv.appendChild(messageContentDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function formatMessage(text) {
            // JSON„Éñ„É≠„ÉÉ„ÇØ„ÅØ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´‰øùË≠∑
            const jsonBlocks = [];
            let tempText = text.replace(/```json\s*([\s\S]*?)\s*```/g, (match, p1) => {
                jsonBlocks.push(match);
                return `__JSON_BLOCK_${jsonBlocks.length - 1}__`;
            });

            // Âü∫Êú¨ÁöÑ„Å™„Éï„Ç©„Éº„Éû„ÉÉ„Éà
            tempText = tempText
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');

            // JSON„Éñ„É≠„ÉÉ„ÇØ„ÇíÂÖÉ„Å´Êàª„Åô
            tempText = tempText.replace(/__JSON_BLOCK_(\d+)__/g, (match, p1) => {
                return jsonBlocks[p1];
            });
            
            return tempText;
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;
            addMessage(message, true);
            input.value = '';
            const sendBtn = document.getElementById('send-btn');
            const sendText = document.getElementById('send-text');
            const loadingText = document.getElementById('loading-text');
            sendBtn.disabled = true;
            sendText.style.display = 'none';
            loadingText.style.display = 'inline';
            try {
                let response = await callApi(message);
                addMessage(response, false);
            } catch (error) {
                addMessage(`„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}<br>„Çµ„Éº„Éê„Éº„ÅåËµ∑Âãï„Åó„Å¶„ÅÑ„Çã„Åã„ÄÅ.env„Éï„Ç°„Ç§„É´„Å´API„Ç≠„Éº„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`, false);
            } finally {
                sendBtn.disabled = false;
                sendText.style.display = 'inline';
                loadingText.style.display = 'none';
            }
        }
        
        function sendQuickMessage(message) {
            document.getElementById('user-input').value = message;
            sendMessage();
        }
        
        function parseAndSaveProgram() {
            const latestAiMessage = conversationHistory.filter(m => !m.isUser).pop();
            if (!latestAiMessage) {
                alert('‰øùÂ≠òÂØæË±°„ÅÆAIÂøúÁ≠î„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ');
                return;
            }

            const jsonMatch = latestAiMessage.content.match(/```json\s*([\s\S]*?)\s*```/);
            if (!jsonMatch || !jsonMatch[1]) {
                alert('AI„ÅÆÂøúÁ≠î„Åã„Çâ„Éà„É¨„Éº„Éã„É≥„Ç∞„É°„Éã„É•„ÉºÔºàJSONÂΩ¢ÂºèÔºâ„ÇíÊäΩÂá∫„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
                return;
            }

            try {
                const programData = JSON.parse(jsonMatch[1]);
                const program = {
                    id: new Date().getTime(),
                    name: programData.programName || `AIÁîüÊàê„Éó„É≠„Ç∞„É©„É† (${new Date().toLocaleDateString()})`,
                    days: programData.days.map(day => ({
                        dayName: day.dayName,
                        exercises: day.isRestDay ? [] : day.exercises.map(ex => ({
                            name: ex.name,
                            sets: ex.sets,
                            reps: ex.reps.toString(),
                            weight: ''
                        }))
                    }))
                };

                if (program.days.length > 0) {
                    let savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
                    savedPrograms.unshift(program);
                    localStorage.setItem('aiPrograms', JSON.stringify(savedPrograms));
                    alert('AI„É°„Éã„É•„Éº„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ„ÄåË®òÈå≤„ÉªËøΩË∑°„Äç„Éö„Éº„Ç∏„Åã„ÇâÂëº„Å≥Âá∫„Åõ„Åæ„Åô„ÄÇ');
                    document.getElementById('program-export').style.display = 'none';
                } else {
                    alert('„Éó„É≠„Ç∞„É©„É†„Å´ÊúâÂäπ„Å™„Éà„É¨„Éº„Éã„É≥„Ç∞Êó•„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ');
                }
            } catch (error) {
                console.error("JSON„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:", error);
                alert(`„Éó„É≠„Ç∞„É©„É†„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇAI„ÅÆÂøúÁ≠î„ÅåÊ≠£„Åó„ÅÑJSONÂΩ¢Âºè„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n„Ç®„É©„Éº: ${error.message}`);
            }
        }

        function loadSavedPrograms() {
            const savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
            const selectEl = document.getElementById('program-select');
            const loaderContainer = document.getElementById('ai-program-loader');
            
            selectEl.innerHTML = '<option value="">„Éó„É≠„Ç∞„É©„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
            savedPrograms.forEach(program => {
                const option = document.createElement('option');
                option.value = program.id;
                option.textContent = program.name;
                selectEl.appendChild(option);
            });
            
            loaderContainer.style.display = savedPrograms.length > 0 ? 'block' : 'none';
            displayProgramDetails('');
        }

        function displayProgramDetails(programId) {
            const detailsContainer = document.getElementById('program-details');
            const actionsContainer = document.getElementById('program-actions');

            if (!programId) {
                detailsContainer.innerHTML = '';
                if(actionsContainer) actionsContainer.style.display = 'none';
                return;
            }
            const savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
            const program = savedPrograms.find(p => p.id == programId);
            if (!program) {
                detailsContainer.innerHTML = '';
                if(actionsContainer) actionsContainer.style.display = 'none';
                return;
            }
            detailsContainer.innerHTML = program.days.map(day => `
                <div class="program-day-card">
                    <h4>${day.dayName}</h4>
                    <ul>
                        ${day.exercises.length > 0 ? day.exercises.map(ex => `
                            <li class="program-exercise-item" onclick='setExerciseFromProgram(${JSON.stringify(ex)})'>
                                ${ex.name}: ${ex.sets}„Çª„ÉÉ„Éà √ó ${ex.reps}Âõû
                            </li>
                        `).join('') : '<li>‰ºëÊÅØÊó•</li>'}
                    </ul>
                </div>
            `).join('');
            if(actionsContainer) actionsContainer.style.display = 'block';
        }
        
        function deleteSelectedProgram() {
            const selectEl = document.getElementById('program-select');
            const programId = selectEl.value;

            if (!programId) {
                alert('ÂâäÈô§„Åô„Çã„Éó„É≠„Ç∞„É©„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            if (confirm('Êú¨ÂΩì„Å´„Åì„ÅÆ„Éó„É≠„Ç∞„É©„É†„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                let savedPrograms = JSON.parse(localStorage.getItem('aiPrograms')) || [];
                savedPrograms = savedPrograms.filter(p => p.id != programId);
                localStorage.setItem('aiPrograms', JSON.stringify(savedPrograms));
                
                alert('„Éó„É≠„Ç∞„É©„É†„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ');
                loadSavedPrograms();
            }
        }

        function setExerciseFromProgram(exerciseData) {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`set${i}-weight`).value = '';
                document.getElementById(`set${i}-reps`).value = '';
            }
            const exerciseSelect = document.getElementById('exercise-select');
            let optionExists = Array.from(exerciseSelect.options).some(opt => opt.value === exerciseData.name);
            if (!optionExists) {
                exerciseSelect.add(new Option(exerciseData.name, exerciseData.name, true, true));
            }
            exerciseSelect.value = exerciseData.name;
            for (let i = 1; i <= exerciseData.sets; i++) {
                if (i > 4) break;
                const weightInput = document.getElementById(`set${i}-weight`);
                const repsInput = document.getElementById(`set${i}-reps`);
                if(exerciseData.weight) weightInput.value = exerciseData.weight;
                repsInput.value = exerciseData.reps.split(/[-~ÔΩû]/)[0].trim();
            }
            document.getElementById('manual-log-section').scrollIntoView({ behavior: 'smooth' });
        }

        function selectExercise(exerciseName) {
            showTab('log');
            const selectEl = document.getElementById('exercise-select');
            selectEl.value = exerciseName;
            document.getElementById('manual-log-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function saveWorkout() {
            const exercise = document.getElementById('exercise-select').value;
            if (!exercise) {
                alert('„Ç®„ÇØ„Çµ„Çµ„Ç§„Ç∫„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            const sets = [];
            for (let i = 1; i <= 4; i++) {
                const weight = document.getElementById(`set${i}-weight`).value;
                const reps = document.getElementById(`set${i}-reps`).value;
                if (weight && reps) {
                    sets.push({ weight: parseFloat(weight), reps: parseInt(reps) });
                }
            }
            if (sets.length === 0) {
                alert('ÊúÄ‰Ωé1„Çª„ÉÉ„Éà„ÅÆË®òÈå≤„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            workoutHistory.unshift({
                date: new Date().toLocaleDateString('ja-JP'),
                exercise: exercise,
                sets: sets,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));
            document.getElementById('exercise-select').value = '';
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`set${i}-weight`).value = '';
                document.getElementById(`set${i}-reps`).value = '';
            }
            displayWorkoutHistory();
            alert('Ë®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
        }

        function displayWorkoutHistory() {
            const historyContainer = document.getElementById('workout-history');
            if (workoutHistory.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }
            historyContainer.innerHTML = workoutHistory.slice(0, 15).map(workout => `
                <div class="log-entry">
                    <div class="log-entry-header">
                        <span class="log-entry-date">${workout.date}</span>
                        <span class="log-entry-exercise">${workout.exercise}</span>
                    </div>
                    <div class="log-entry-sets">
                        ${workout.sets.map((set, index) => `
                            <span class="set-badge">${index + 1}„Çª„ÉÉ„Éà: ${set.weight}kg √ó ${set.reps}Âõû</span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        document.addEventListener('DOMContentLoaded', function() {
            showTab('menu'); // ÂàùÊúüË°®Á§∫„Çø„Éñ
            const userInput = document.getElementById('user-input');
            if (userInput) {
                userInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
        });
    </script>
    </body>
</html>